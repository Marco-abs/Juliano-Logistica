(function(){
    'use strict';
    
    // Mobile Menu Toggle
    var mobileMenu = document.getElementById('mobile-menu');
    var navMenu = document.querySelector('.nav-menu');
    
    if (mobileMenu && navMenu) {
        mobileMenu.addEventListener('click', function(e) {
            e.preventDefault();
            var isActive = this.classList.contains('active');
            this.classList.toggle('active');
            navMenu.classList.toggle('active');
            this.setAttribute('aria-expanded', !isActive);
        });
        
        // Close mobile menu when clicking on a link
        var navLinks = document.querySelectorAll('.nav-link');
        navLinks.forEach(function(link) {
            link.addEventListener('click', function() {
                mobileMenu.classList.remove('active');
                navMenu.classList.remove('active');
                mobileMenu.setAttribute('aria-expanded', 'false');
            });
        });
    }
    
    // Smooth scrolling for navigation links
    var anchors = document.querySelectorAll('a[href^="#"]');
    anchors.forEach(function(anchor) {
        anchor.addEventListener('click', function(e) {
            e.preventDefault();
            var targetId = this.getAttribute('href');
            var target = document.querySelector(targetId);
            
            if (target) {
                var headerHeight = document.querySelector('.header').offsetHeight || 0;
                var targetPosition = target.offsetTop - headerHeight;
                
                window.scrollTo({
                    top: targetPosition,
                    behavior: 'smooth'
                });
            }
        });
    });
    
    // Header scroll effect
    var ticking = false;
    var header = document.querySelector('.header');
    
    if (header) {
        function updateHeader() {
            if (window.scrollY > 100) {
                header.style.background = 'rgba(255, 255, 255, 0.95)';
                header.style.backdropFilter = 'blur(10px)';
            } else {
                header.style.background = '#fff';
                header.style.backdropFilter = 'none';
            }
            ticking = false;
        }
        
        function requestTick() {
            if (!ticking) {
                requestAnimationFrame(updateHeader);
                ticking = true;
            }
        }
        
        window.addEventListener('scroll', requestTick, { passive: true });
    }
    
    // Contact Form Handling
    var contactForm = document.getElementById('contactForm');
    
    if (contactForm) {
        // Validation functions
        function validateEmail(email) {
            return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
        }
        
        function validatePhone(phone) {
            var cleanPhone = phone.replace(/\D/g, '');
            return cleanPhone.length >= 10 && cleanPhone.length <= 15;
        }
        
        // Real-time validation
        var emailField = contactForm.querySelector('#email');
        var phoneField = contactForm.querySelector('#phone');
        
        if (emailField) {
            emailField.addEventListener('blur', function() {
                if (this.value && !validateEmail(this.value)) {
                    this.style.borderColor = '#e74c3c';
                    showFieldError(this, 'E-mail inválido');
                } else {
                    this.style.borderColor = '#e0e0e0';
                    hideFieldError(this);
                }
            });
        }
        
        if (phoneField) {
            phoneField.addEventListener('blur', function() {
                if (this.value && !validatePhone(this.value)) {
                    this.style.borderColor = '#e74c3c';
                    showFieldError(this, 'Telefone inválido');
                } else {
                    this.style.borderColor = '#e0e0e0';
                    hideFieldError(this);
                }
            });
        }
        
        // Form submission
        contactForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            var formData = new FormData(this);
            var name = formData.get('name').trim();
            var email = formData.get('email').trim();
            var phone = formData.get('phone').trim();
            var message = formData.get('message').trim();
            
            // Validate form
            if (!name || !email || !phone || !message) {
                showNotification('Por favor, preencha todos os campos.', 'error');
                return;
            }
            
            if (!validateEmail(email)) {
                showNotification('Por favor, insira um e-mail válido.', 'error');
                return;
            }
            
            if (!validatePhone(phone)) {
                showNotification('Por favor, insira um telefone válido.', 'error');
                return;
            }
            
            // Create WhatsApp message
            var whatsappMessage = 'Olá! Gostaria de solicitar um orçamento.\n\n' +
                '*Dados do Cliente:*\n' +
                'Nome: ' + name + '\n' +
                'E-mail: ' + email + '\n' +
                'Telefone: ' + phone + '\n\n' +
                '*Mensagem:*\n' +
                message + '\n\n' +
                'Aguardo retorno!';
            
            // Encode message for URL
            var encodedMessage = encodeURIComponent(whatsappMessage);
            var whatsappURL = 'https://wa.me/5548996491352?text=' + encodedMessage;
            
            // Open WhatsApp
            window.open(whatsappURL, '_blank', 'noopener,noreferrer');
            
            // Show success message
            showNotification('Redirecionando para o WhatsApp...', 'success');
            
            // Reset form
            this.reset();
        });
        
        // Helper functions
        function showFieldError(field, message) {
            hideFieldError(field);
            var error = document.createElement('div');
            error.className = 'field-error';
            error.textContent = message;
            error.style.cssText = 'color: #e74c3c; font-size: 0.9rem; margin-top: 5px;';
            field.parentNode.appendChild(error);
        }
        
        function hideFieldError(field) {
            var existingError = field.parentNode.querySelector('.field-error');
            if (existingError) {
                existingError.remove();
            }
        }
    }
    
    // Notification system
    function showNotification(message, type) {
        type = type || 'info';
        
        // Remove existing notifications
        var existingNotification = document.querySelector('.notification');
        if (existingNotification) {
            existingNotification.remove();
        }
        
        // Create notification element
        var notification = document.createElement('div');
        notification.className = 'notification notification-' + type;
        notification.innerHTML = '<div class="notification-content">' +
            '<i class="fas ' + (type === 'success' ? 'fa-check-circle' : type === 'error' ? 'fa-exclamation-circle' : 'fa-info-circle') + '"></i>' +
            '<span>' + message + '</span>' +
            '</div>';
        
        // Add styles
        notification.style.cssText = 'position: fixed;' +
            'top: 90px;' +
            'right: 20px;' +
            'background: ' + (type === 'success' ? '#25d366' : type === 'error' ? '#e74c3c' : '#2c5aa0') + ';' +
            'color: white;' +
            'padding: 15px 20px;' +
            'border-radius: 10px;' +
            'box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);' +
            'z-index: 10000;' +
            'animation: slideInRight 0.3s ease;' +
            'max-width: 300px;';
        
        // Add animation styles
        var style = document.createElement('style');
        style.textContent = '@keyframes slideInRight {' +
            'from { transform: translateX(100%); opacity: 0; }' +
            'to { transform: translateX(0); opacity: 1; }' +
            '}' +
            '.notification-content { display: flex; align-items: center; gap: 10px; }';
        document.head.appendChild(style);
        
        // Add to page
        document.body.appendChild(notification);
        
        // Auto remove after 5 seconds
        setTimeout(function() {
            if (notification.parentNode) {
                notification.style.animation = 'slideInRight 0.3s ease reverse';
                setTimeout(function() {
                    notification.remove();
                }, 300);
            }
        }, 5000);
    }
    
    // Intersection Observer for animations
    var observerOptions = {
        threshold: 0.1,
        rootMargin: '0px 0px -50px 0px'
    };
    
    var observer = new IntersectionObserver(function(entries) {
        entries.forEach(function(entry) {
            if (entry.isIntersecting) {
                entry.target.style.opacity = '1';
                entry.target.style.transform = 'translateY(0)';
            }
        });
    }, observerOptions);
    
    // Observe elements for animation
    document.addEventListener('DOMContentLoaded', function() {
        var animatedElements = document.querySelectorAll('.service-card, .contact-item, .feature');
        
        animatedElements.forEach(function(el) {
            el.style.opacity = '0';
            el.style.transform = 'translateY(30px)';
            el.style.transition = 'opacity 0.6s ease, transform 0.6s ease';
            observer.observe(el);
        });
    });
    
    // WhatsApp button click tracking
    document.querySelectorAll('a[href*="wa.me"]').forEach(function(button) {
        button.addEventListener('click', function() {
            console.log('WhatsApp button clicked');
        });
    });
    
    // Add smooth reveal animation for sections
    var revealElements = document.querySelectorAll('.section-header, .about-content, .services-grid, .contact-content');
    var revealObserver = new IntersectionObserver(function(entries) {
        entries.forEach(function(entry) {
            if (entry.isIntersecting) {
                entry.target.style.opacity = '1';
                entry.target.style.transform = 'translateY(0)';
            }
        });
    }, { threshold: 0.1 });
    
    revealElements.forEach(function(el) {
        el.style.opacity = '0';
        el.style.transform = 'translateY(30px)';
        el.style.transition = 'opacity 0.8s ease, transform 0.8s ease';
        revealObserver.observe(el);
    });
    
    // Add click-to-call functionality for phone numbers
    document.querySelectorAll('a[href^="tel:"]').forEach(function(link) {
        link.addEventListener('click', function(e) {
            e.preventDefault();
            var phoneNumber = this.getAttribute('href').replace('tel:', '');
            window.open('tel:' + phoneNumber);
        });
    });
    
    console.log('Juliano Logística - Site carregado com sucesso!');
})();